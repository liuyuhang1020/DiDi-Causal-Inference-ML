# 需要改为自己机器的地址，python3的环境。
export PYSPARK_PYTHON=/usr/local/bin/python3


PARAM='{"amount_type":"headquarters_budget","budget":34773195.9516,"budget_limit":34773195.9516,"callback_ip":"http://10.88.128.149:32234/darwin/","child_info":"[{\"step_id\":1,\"status\":1,\"start_ux\":1679846400,\"end_ux\":1680278399,\"step_type\":\"b_decision\",\"step_budget\":34773195.9516,\"exc_id\":14154657,\"validation_version\":\"\",\"cr_type\":\"exp_finish_order_pp\",\"validation_order\":[0],\"ext_data\":{\"ct_1_amount\":0,\"bt_1_amount\":0,\"artificial\":null,\"budget_limit\":[]},\"operator\":\"luoyuexi\"}]","city_group_budget_amount_limit_list":null,"cost":0,"end_date":"2023-03-31","ext_data":"{\"artificial\":null,\"bt_1_amount\":0,\"budget_limit\":[],\"ct_1_amount\":0,\"gross_profit_fee\":51621893.84920418,\"input_city_info\":[{\"d\":\"2023-03-27\",\"pl\":\"kuaiche\",\"ca\":\"dispatch_b\",\"cis\":[284,105,306,33,28,32,109,140,232,57,166,117,86,174,231,248,266,301,52,74,196,219,1,8,283,45,145,154,58,67,118,13,294,156,220,23,138,157,35,254,9,16,64,297,255,42,65,98,132,149,158,265,286,303,305,40,137,249,26,144,261,91,34,82,175,253,7,47,292,63,56,280,299,20,55,168,242,262,193,260,267,104,133,302,72,102,120,224,107,199,153,59,198,296,308,38,141,162,14,226,246,54,125,146,353,124,185,258,129,247,36,78,116,256,85,287,61,298,21,96,225,177,281,282,53,88,178,60,89,163,49,222,30,76,39,71,160,15,243,127,148,22,171,228,251,264,300,25,44,46,135]},{\"d\":\"2023-03-28\",\"pl\":\"kuaiche\",\"ca\":\"dispatch_b\",\"cis\":[284,105,306,33,28,32,109,140,232,57,166,117,86,174,231,248,266,301,52,74,196,219,1,8,283,45,145,154,58,67,118,13,294,156,220,23,138,157,35,254,9,16,64,297,255,42,65,98,132,149,158,265,286,303,305,40,137,249,26,144,261,91,34,82,175,253,7,47,292,63,56,280,299,20,55,168,242,262,193,260,267,104,133,302,72,102,120,224,107,199,153,59,198,296,308,38,141,162,14,226,246,54,125,146,353,124,185,258,129,247,36,78,116,256,85,287,61,298,21,96,225,177,281,282,53,88,178,60,89,163,49,222,30,76,39,71,160,15,243,127,148,22,171,228,251,264,300,25,44,46,135]},{\"d\":\"2023-03-29\",\"pl\":\"kuaiche\",\"ca\":\"dispatch_b\",\"cis\":[284,105,306,33,28,32,109,140,232,57,166,117,86,174,231,248,266,301,52,74,196,219,1,8,283,45,145,154,58,67,118,13,294,156,220,23,138,157,35,254,9,16,64,297,255,42,65,98,132,149,158,265,286,303,305,40,137,249,26,144,261,91,34,82,175,253,7,47,292,63,56,280,299,20,55,168,242,262,193,260,267,104,133,302,72,102,120,224,107,199,153,59,198,296,308,38,141,162,14,226,246,54,125,146,353,124,185,258,129,247,36,78,116,256,85,287,61,298,21,96,225,177,281,282,53,88,178,60,89,163,49,222,30,76,39,71,160,15,243,127,148,22,171,228,251,264,300,25,44,46,135]},{\"d\":\"2023-03-30\",\"pl\":\"kuaiche\",\"ca\":\"dispatch_b\",\"cis\":[284,105,306,33,28,32,109,140,232,57,166,117,86,174,231,248,266,301,52,74,196,219,1,8,283,45,145,154,58,67,118,13,294,156,220,23,138,157,35,254,9,16,64,297,255,42,65,98,132,149,158,265,286,303,305,40,137,249,26,144,261,91,34,82,175,253,7,47,292,63,56,280,299,20,55,168,242,262,193,260,267,104,133,302,72,102,120,224,107,199,153,59,198,296,308,38,141,162,14,226,246,54,125,146,353,124,185,258,129,247,36,78,116,256,85,287,61,298,21,96,225,177,281,282,53,88,178,60,89,163,49,222,30,76,39,71,160,15,243,127,148,22,171,228,251,264,300,25,44,46,135]},{\"d\":\"2023-03-31\",\"pl\":\"kuaiche\",\"ca\":\"dispatch_b\",\"cis\":[284,105,306,33,28,32,109,140,232,57,166,117,86,174,231,248,266,301,52,74,196,219,1,8,283,45,145,154,58,67,118,13,294,156,220,23,138,157,35,254,9,16,64,297,255,42,65,98,132,149,158,265,286,303,305,40,137,249,26,144,261,91,34,82,175,253,7,47,292,63,56,280,299,20,55,168,242,262,193,260,267,104,133,302,72,102,120,224,107,199,153,59,198,296,308,38,141,162,14,226,246,54,125,146,353,124,185,258,129,247,36,78,116,256,85,287,61,298,21,96,225,177,281,282,53,88,178,60,89,163,49,222,30,76,39,71,160,15,243,127,148,22,171,228,251,264,300,25,44,46,135]}]}","is_online":"online","operator":"admin","order_id":373,"rely_info":"{\"cr_dt\":\"2023-03-24\",\"gmv_dt\":\"2023-03-23\"}","start_date":"2023-03-27","step_end_date":"2023-03-31","step_id":2,"step_start_date":"2023-03-27","step_type":"dispatch_allocation","stg_version":"","trace_id":"0aacb0fd641d8ef8b00b052b404ca0b0","trigger_time":"2023-03-24T19:52:24.468199631+08:00","version_list":""}'

DATE_DEF=${timeparts:3:10}
DATE=${2-"$DATE_DEF"}
CONFIG="./conf/job_config.json"
MODE=$1

spark-submit \
    --executor-cores 3 \
    --driver-memory 6g \
    --executor-memory 18g \
    --conf spark.default.parallelism=2400 \
    --conf spark.dynamicAllocation.maxExecutors=40 \
    --conf spark.driver.maxResultSize=5g \
    --conf spark.yarn.dist.archives=hdfs://DClusterNmg4/user/bigdata_driver_ecosys_test/ly/python_env/python3.6.2.tgz#python3.6.2 \
    --conf spark.pyspark.driver.python=/home/luban/anaconda3/envs/python36/bin/python \
    --conf spark.pyspark.python=./python3.6.2/bin/python \
    --conf spark.yarn.appMasterEnv.PYSPARK_PYTHON=./python3.6.2/bin/python \
    --conf spark.yarn.appMasterEnv.LD_LIBRARY_PATH=/usr/local/hadoop-current/lib/native \
    --queue root.pricing_dape_core_service_prod \
    --py-files main_strategy.py,utils.py,hive_sql.py \
    generate_strategy.py   --config "${CONFIG}" --date "${DATE}" --parameter="${PARAM}" --mode="${MODE}"


# --conf spark.yarn.appMasterEnv.PYSPARK_PYTHON=./python3.6.2/bin/python 需要改为自己机器的地址，python3的环境。
