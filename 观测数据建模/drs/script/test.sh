# 需要改为自己机器的地址，python3的环境。
export PYSPARK_PYTHON=/home/luban/anaconda3/envs/python36/bin/python

PARAM='{"amount_type":"headquarters_budget","budget":14742268.4918,"budget_limit":10364429.691179164,"callback_ip":"http://10.88.128.149:32234/darwin/","child_info":"[{\"step_id\":1,\"status\":3,\"start_ux\":1687104000,\"end_ux\":1687276799,\"step_type\":\"b_decision\",\"step_budget\":14742268.4918,\"exc_id\":15273287,\"validation_version\":\"b\",\"cr_type\":\"exp_finish_order_pp\",\"validation_order\":[2023006488,2023006490,2023006492,2023006494],\"ext_data\":{\"ct_1_amount\":0,\"bt_1_amount\":0,\"artificial\":null,\"budget_limit\":[]},\"operator\":\"admin\"},{\"step_id\":2,\"status\":3,\"start_ux\":1687104000,\"end_ux\":1687276799,\"step_type\":\"dispatch_allocation\",\"step_budget\":14742268.4918,\"exc_id\":15275579,\"validation_version\":\"\",\"cr_type\":\"\",\"validation_order\":[2023006592],\"ext_data\":{\"ct_1_amount\":0,\"bt_1_amount\":0,\"artificial\":null,\"budget_limit\":[]},\"operator\":\"admin\"},{\"step_id\":4,\"status\":3,\"start_ux\":1687104000,\"end_ux\":1687190399,\"step_type\":\"B_T_1\",\"step_budget\":710000,\"exc_id\":15295231,\"validation_version\":\"\",\"cr_type\":\"\",\"validation_order\":[2023006636],\"ext_data\":{\"ct_1_amount\":0,\"bt_1_amount\":710000,\"artificial\":null,\"budget_limit\":[]},\"operator\":\"admin\"},{\"step_id\":7,\"status\":3,\"start_ux\":1687104000,\"end_ux\":1687190399,\"step_type\":\"hufan_T_1\",\"step_budget\":20795076.440442733,\"exc_id\":15300299,\"validation_version\":\"\",\"cr_type\":\"\",\"validation_order\":[2023006656,2023006658,2023006660,2023006662],\"ext_data\":{\"ct_1_amount\":2557937.399839552,\"bt_1_amount\":0,\"artificial\":null,\"budget_limit\":[]},\"operator\":\"wanhao\"},{\"step_id\":11,\"status\":3,\"start_ux\":1687190400,\"end_ux\":1687276799,\"step_type\":\"B_T_1\",\"step_budget\":600000,\"exc_id\":15308613,\"validation_version\":\"\",\"cr_type\":\"\",\"validation_order\":[2023006806],\"ext_data\":{\"ct_1_amount\":0,\"bt_1_amount\":600000,\"artificial\":[{\"date\":\"2023-06-20\",\"city_id\":16,\"time_range\":[\"07:00:00\",\"09:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.015},{\"date\":\"2023-06-20\",\"city_id\":16,\"time_range\":[\"11:00:00\",\"14:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.005},{\"date\":\"2023-06-20\",\"city_id\":16,\"time_range\":[\"16:00:00\",\"18:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.01},{\"date\":\"2023-06-20\",\"city_id\":38,\"time_range\":[\"06:00:00\",\"09:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.015},{\"date\":\"2023-06-20\",\"city_id\":38,\"time_range\":[\"13:30:00\",\"17:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.006999999999999999},{\"date\":\"2023-06-20\",\"city_id\":25,\"time_range\":[\"06:00:00\",\"09:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.012},{\"date\":\"2023-06-20\",\"city_id\":25,\"time_range\":[\"11:00:00\",\"14:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.006999999999999999},{\"date\":\"2023-06-20\",\"city_id\":25,\"time_range\":[\"20:30:00\",\"22:30:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.005},{\"date\":\"2023-06-20\",\"city_id\":8,\"time_range\":[\"06:00:00\",\"09:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.01},{\"date\":\"2023-06-20\",\"city_id\":7,\"time_range\":[\"06:00:00\",\"09:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.005},{\"date\":\"2023-06-20\",\"city_id\":7,\"time_range\":[\"17:00:00\",\"20:00:00\"],\"fence_id\":-1,\"caller\":\"b\",\"daily_b_rate\":0.003}],\"budget_limit\":[]},\"operator\":\"admin\"}]","city_group_budget_amount_limit_list":[{"date_range":["2023-06-20","2023-06-20"],"city_list":[1],"pl":"all","caller":"dape-aps","limit":{"max":5785295.598359346,"min":0}},{"date_range":["2023-06-20","2023-06-20"],"city_list":[8,14,16,22,25,26,28,32,33,34,35,36,39,40,42,43,44,47,49,52,53,55,56,61,63,65,66,67,68,69,70,71,72,73,74,75,77,85,86,88,96,98,99,103,104,105,107,109,116,117,119,120,122,124,125,126,127,128,129,130,131,132,133,135,137,138,140,141,144,145,146,148,150,153,154,156,157,162,164,168,169,171,174,175,177,178,179,180,181,185,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,220,222,225,226,228,230,231,232,238,239,242,243,246,247,249,251,252,253,254,255,256,258,260,261,262,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,280,281,282,283,284,286,290,291,292,294,295,296,297,298,299,300,301,302,303,305,306,308,309,310,311,312,313,314,315,316,317,318,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,359,360,361,362,363,364,365,366,367,368,369,370,371,372],"pl":"all","caller":"dape-aps","limit":{"max":4579134.092819818,"min":0}}],"cost":22836509.73,"end_date":"2023-06-20","ext_data":"{\"artificial\":null,\"bt_1_amount\":0,\"budget_limit\":null,\"ct_1_amount\":2557913.904387096,\"gross_profit_fee\":49235465.783983044,\"input_city_info\":[{\"d\":\"2023-06-20\",\"pl\":\"kuaiche\",\"ca\":\"dape-aps\",\"cis\":[284,348,105,131,150,306,329,338,33,119,314,323,327,372,28,32,109,140,164,232,328,351,117,86,174,231,266,301,52,68,74,196,1,122,334,8,213,283,169,215,145,154,67,326,359,252,294,343,364,156,220,346,138,157,321,333,362,35,254,318,16,194,195,297,255,42,65,98,132,339,128,322,180,265,286,205,209,360,303,305,40,73,137,200,249,363,202,270,271,272,311,317,341,26,144,197,269,261,369,295,34,175,179,253,342,47,207,292,63,192,201,238,278,56,206,273,280,330,299,55,103,168,242,262,193,239,260,361,365,267,291,366,104,133,190,210,302,354,72,120,214,107,199,347,153,274,198,296,308,340,141,162,203,14,77,226,371,246,66,125,146,218,276,211,353,124,181,185,258,275,129,247,268,310,315,352,36,116,126,256,85,130,216,217,290,61,298,313,345,96,225,337,349,69,177,281,282,316,368,53,88,277,325,335,178,70,49,222,309,312,324,356,320,43,336,191,39,71,212,99,243,367,370,127,148,230,344,350,355,22,171,228,251,332,264,300,25,44,75,135,208,331]},{\"d\":\"2023-06-20\",\"pl\":\"tehui\",\"ca\":\"dape-aps\",\"cis\":[284,348,105,131,150,306,329,338,33,119,314,323,327,372,28,32,109,140,164,232,328,351,117,86,174,231,266,301,52,68,74,196,1,122,334,8,213,283,169,215,145,154,67,326,359,252,294,343,364,156,220,346,138,157,321,333,362,35,254,318,16,194,195,297,255,42,65,98,132,339,128,322,180,265,286,205,209,360,303,305,40,73,137,200,249,363,202,270,271,272,311,317,341,26,144,197,269,261,369,295,34,175,179,253,342,47,207,292,63,192,201,238,278,56,206,273,280,330,299,55,103,168,242,262,193,239,260,361,365,267,291,366,104,133,190,210,302,354,72,120,214,107,199,347,153,274,198,296,308,340,141,162,203,14,77,226,371,246,66,125,146,218,276,211,353,124,181,185,258,275,129,247,268,310,315,352,36,116,126,256,85,130,216,217,290,61,298,313,345,96,225,337,349,69,177,281,282,316,368,53,88,277,325,335,178,70,49,222,309,312,324,356,320,43,336,191,39,71,212,99,243,367,370,127,148,230,344,350,355,22,171,228,251,332,264,300,25,44,75,135,208,331]}]}","is_online":"online","operator":"admin","order_id":463,"rely_info":"{\"cr_dt\":\"2023-06-19\",\"gmv_dt\":\"2023-06-18\"}","start_date":"2023-06-19","step_end_date":"2023-06-20","step_id":12,"step_start_date":"2023-06-20","step_type":"hufan_T_1","stg_version":"multi_target_v0","trace_id":"0aa98b88648feee5c29f0536a88c0bb0","trigger_time":"2023-06-19T14:00:06.774617216+08:00","version_list":""}'
DATE_DEF=${timeparts:3:10}
DATE=${2-"$DATE_DEF"}
CONFIG="./conf/job_config.json"
MODE=3
spark-submit \
   --executor-cores 3 \
   --driver-memory 6g \
   --executor-memory 18g \
   --conf spark.default.parallelism=2400 \
   --conf spark.dynamicAllocation.maxExecutors=40 \
   --conf spark.driver.maxResultSize=5g \
   --conf spark.yarn.dist.archives=hdfs://DClusterNmg4/user/bigdata_driver_ecosys_test/ly/python_env/python3.6.2.tgz#python3.6.2 \
   --conf spark.pyspark.driver.python=/home/luban/anaconda3/envs/python36/bin/python \
   --conf spark.pyspark.python=./python3.6.2/bin/python \
   --conf spark.yarn.appMasterEnv.PYSPARK_PYTHON=./python3.6.2/bin/python \
   --conf spark.yarn.appMasterEnv.LD_LIBRARY_PATH=/usr/local/hadoop-current/lib/native \
   --queue root.kg_novel_dev \
   --py-files main.py \
   main.py   --config "${CONFIG}" --date "${DATE}" --parameter="${PARAM}" --mode="${MODE}"

